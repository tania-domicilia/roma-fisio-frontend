{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\FA INNOVATIONS TECH\\\\Downloads\\\\Nuovo progetto fisio\\\\roma-fisio-frontend (13)\\\\src\\\\pages\\\\MappaPazientiPage.jsx\",\n  _s = $RefreshSig$(),\n  _s2 = $RefreshSig$();\nimport { useEffect, useState } from \"react\";\nimport { MapContainer, TileLayer, Marker, Popup, useMap } from \"react-leaflet\";\nimport \"leaflet/dist/leaflet.css\";\nimport L from \"leaflet\";\nimport \"leaflet-control-geocoder\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst API_URL = process.env.REACT_APP_API_URL || \"http://localhost:8000\";\nconst customIcon = new L.Icon({\n  iconUrl: \"https://unpkg.com/leaflet@1.9.4/dist/images/marker-icon.png\",\n  iconSize: [25, 41],\n  iconAnchor: [12, 41],\n  popupAnchor: [1, -34]\n});\nfunction GeocoderControl() {\n  _s();\n  const map = useMap();\n  useEffect(() => {\n    if (!map) return;\n    const geocoder = L.Control.geocoder({\n      defaultMarkGeocode: true\n    }).on(\"markgeocode\", function (e) {\n      const {\n        center\n      } = e.geocode;\n      L.marker(center, {\n        icon: customIcon\n      }).addTo(map).bindPopup(e.geocode.name).openPopup();\n      map.setView(center, 15);\n    }).addTo(map);\n  }, [map]);\n  return null;\n}\n_s(GeocoderControl, \"IoceErwr5KVGS9kN4RQ1bOkYMAg=\", false, function () {\n  return [useMap];\n});\n_c = GeocoderControl;\nexport default function MappaPazientiPage() {\n  _s2();\n  const [markers, setMarkers] = useState([]);\n  useEffect(() => {\n    fetch(`${API_URL}/pazienti`).then(res => res.json()).then(async data => {\n      const NOMINATIM_URL = \"https://nominatim.openstreetmap.org/search\";\n      const coords = await Promise.all(data.map(async p => {\n        const fullAddress = encodeURIComponent(`${p.indirizzo}, ${p.cap} ${p.citta}`);\n        const res = await fetch(`${NOMINATIM_URL}/${fullAddress}?format=json&limit=1`);\n        const geo = await res.json();\n        if (geo.length > 0) {\n          return {\n            id: p.id,\n            nome: p.nome,\n            cognome: p.cognome,\n            indirizzo: p.indirizzo,\n            data_inizio_piano: p.data_inizio_piano,\n            data_fine_piano: p.data_fine_piano,\n            lat: parseFloat(geo[0].lat),\n            lon: parseFloat(geo[0].lon)\n          };\n        } else {\n          return null;\n        }\n      }));\n      setMarkers(coords.filter(m => m));\n    });\n  }, []);\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"p-4\",\n    children: [/*#__PURE__*/_jsxDEV(\"h1\", {\n      className: \"text-xl font-bold mb-4\",\n      children: \"Mappa Pazienti + Ricerca\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 71,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(MapContainer, {\n      center: [41.89, 12.49],\n      zoom: 11,\n      style: {\n        height: \"70vh\",\n        width: \"100%\"\n      },\n      children: [/*#__PURE__*/_jsxDEV(TileLayer, {\n        attribution: \"Map data \\xA9 <a href=\\\"https://openstreetmap.org\\\">OpenStreetMap</a>\",\n        url: \"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 73,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(GeocoderControl, {}, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 77,\n        columnNumber: 9\n      }, this), markers.map(m => /*#__PURE__*/_jsxDEV(Marker, {\n        position: [m.lat, m.lon],\n        icon: customIcon,\n        children: /*#__PURE__*/_jsxDEV(Popup, {\n          children: [/*#__PURE__*/_jsxDEV(\"strong\", {\n            children: [m.nome, \" \", m.cognome]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 81,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(\"br\", {}, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 81,\n            columnNumber: 52\n          }, this), m.indirizzo, /*#__PURE__*/_jsxDEV(\"br\", {}, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 82,\n            columnNumber: 28\n          }, this), m.data_inizio_piano, \" \\u2192 \", m.data_fine_piano]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 80,\n          columnNumber: 13\n        }, this)\n      }, m.id, false, {\n        fileName: _jsxFileName,\n        lineNumber: 79,\n        columnNumber: 11\n      }, this))]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 72,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 70,\n    columnNumber: 5\n  }, this);\n}\n_s2(MappaPazientiPage, \"aVe0o7Xd1RI2qqyy9XuFimi/3oU=\");\n_c2 = MappaPazientiPage;\nvar _c, _c2;\n$RefreshReg$(_c, \"GeocoderControl\");\n$RefreshReg$(_c2, \"MappaPazientiPage\");","map":{"version":3,"names":["useEffect","useState","MapContainer","TileLayer","Marker","Popup","useMap","L","jsxDEV","_jsxDEV","API_URL","process","env","REACT_APP_API_URL","customIcon","Icon","iconUrl","iconSize","iconAnchor","popupAnchor","GeocoderControl","_s","map","geocoder","Control","defaultMarkGeocode","on","e","center","geocode","marker","icon","addTo","bindPopup","name","openPopup","setView","_c","MappaPazientiPage","_s2","markers","setMarkers","fetch","then","res","json","data","NOMINATIM_URL","coords","Promise","all","p","fullAddress","encodeURIComponent","indirizzo","cap","citta","geo","length","id","nome","cognome","data_inizio_piano","data_fine_piano","lat","parseFloat","lon","filter","m","className","children","fileName","_jsxFileName","lineNumber","columnNumber","zoom","style","height","width","attribution","url","position","_c2","$RefreshReg$"],"sources":["C:/Users/FA INNOVATIONS TECH/Downloads/Nuovo progetto fisio/roma-fisio-frontend (13)/src/pages/MappaPazientiPage.jsx"],"sourcesContent":["import { useEffect, useState } from \"react\";\nimport { MapContainer, TileLayer, Marker, Popup, useMap } from \"react-leaflet\";\nimport \"leaflet/dist/leaflet.css\";\nimport L from \"leaflet\";\nimport \"leaflet-control-geocoder\";\n\nconst API_URL = process.env.REACT_APP_API_URL || \"http://localhost:8000\";\n\nconst customIcon = new L.Icon({\n  iconUrl: \"https://unpkg.com/leaflet@1.9.4/dist/images/marker-icon.png\",\n  iconSize: [25, 41],\n  iconAnchor: [12, 41],\n  popupAnchor: [1, -34],\n});\n\nfunction GeocoderControl() {\n  const map = useMap();\n  useEffect(() => {\n    if (!map) return;\n    const geocoder = L.Control.geocoder({\n      defaultMarkGeocode: true,\n    })\n      .on(\"markgeocode\", function (e) {\n        const { center } = e.geocode;\n        L.marker(center, { icon: customIcon })\n          .addTo(map)\n          .bindPopup(e.geocode.name)\n          .openPopup();\n        map.setView(center, 15);\n      })\n      .addTo(map);\n  }, [map]);\n  return null;\n}\n\nexport default function MappaPazientiPage() {\n  const [markers, setMarkers] = useState([]);\n\n  useEffect(() => {\n    fetch(`${API_URL}/pazienti`)\n      .then((res) => res.json())\n      .then(async (data) => {\n        const NOMINATIM_URL = \"https://nominatim.openstreetmap.org/search\";\n        const coords = await Promise.all(\n          data.map(async (p) => {\n            const fullAddress = encodeURIComponent(`${p.indirizzo}, ${p.cap} ${p.citta}`);\n            const res = await fetch(`${NOMINATIM_URL}/${fullAddress}?format=json&limit=1`);\n            const geo = await res.json();\n            if (geo.length > 0) {\n              return {\n                id: p.id,\n                nome: p.nome,\n                cognome: p.cognome,\n                indirizzo: p.indirizzo,\n                data_inizio_piano: p.data_inizio_piano,\n                data_fine_piano: p.data_fine_piano,\n                lat: parseFloat(geo[0].lat),\n                lon: parseFloat(geo[0].lon),\n              };\n            } else {\n              return null;\n            }\n          })\n        );\n        setMarkers(coords.filter((m) => m));\n      });\n  }, []);\n\n  return (\n    <div className=\"p-4\">\n      <h1 className=\"text-xl font-bold mb-4\">Mappa Pazienti + Ricerca</h1>\n      <MapContainer center={[41.89, 12.49]} zoom={11} style={{ height: \"70vh\", width: \"100%\" }}>\n        <TileLayer\n          attribution='Map data &copy; <a href=\"https://openstreetmap.org\">OpenStreetMap</a>'\n          url=\"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png\"\n        />\n        <GeocoderControl />\n        {markers.map((m) => (\n          <Marker key={m.id} position={[m.lat, m.lon]} icon={customIcon}>\n            <Popup>\n              <strong>{m.nome} {m.cognome}</strong><br />\n              {m.indirizzo}<br />\n              {m.data_inizio_piano} â†’ {m.data_fine_piano}\n            </Popup>\n          </Marker>\n        ))}\n      </MapContainer>\n    </div>\n  );\n}\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}